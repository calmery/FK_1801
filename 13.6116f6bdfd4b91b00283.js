(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{d995:function(n,t,e){"use strict";e.r(t);var r,l=e("CcnG"),i=(e("OO+k"),e("cF7/")),a=e("t/Na"),o=function(){function n(n){this.http=n}return n.prototype.post=function(n,t){return e=this,void 0,l=function(){return function(n,t){var e,r,l,i,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(l=2&i[0]?r.return:i[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,i[1])).done)return l;switch(r=0,l&&(i=[2&i[0],l.value]),i[0]){case 0:case 1:l=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(l=(l=a.trys).length>0&&l[l.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!l||i[1]>l[0]&&i[1]<l[3])){a.label=i[1];break}if(6===i[0]&&a.label<l[1]){a.label=l[1],l=i;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(i);break}l[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(n,a)}catch(n){i=[6,n],r=0}finally{e=l=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.http.post(""+i.b+i.a.food,{id:n,blob:t}).toPromise()];case 1:return[2,e.sent()];case 2:throw e.sent();case 3:return[2]}})},new((r=void 0)||(r=Promise))(function(n,t){function i(n){try{o(l.next(n))}catch(n){t(n)}}function a(n){try{o(l.throw(n))}catch(n){t(n)}}function o(t){t.done?n(t.value):new r(function(n){n(t.value)}).then(i,a)}o((l=l.apply(e,[])).next())});var e,r,l},n.ngInjectableDef=l.V({factory:function(){return new n(l.Z(a.c))},token:n,providedIn:"root"}),n}(),u=e("ZJFI"),s=e("UriW"),c=function(n,t,e,r){return new(e||(e=Promise))(function(l,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function o(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){n.done?l(n.value):new e(function(t){t(n.value)}).then(a,o)}u((r=r.apply(n,t||[])).next())})},h=function(n,t){var e,r,l,i,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(l=2&i[0]?r.return:i[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,i[1])).done)return l;switch(r=0,l&&(i=[2&i[0],l.value]),i[0]){case 0:case 1:l=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(l=(l=a.trys).length>0&&l[l.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!l||i[1]>l[0]&&i[1]<l[3])){a.label=i[1];break}if(6===i[0]&&a.label<l[1]){a.label=l[1],l=i;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(i);break}l[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(n,a)}catch(n){i=[6,n],r=0}finally{e=l=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}};!function(n){n.Environment="environment",n.User="user"}(r||(r={}));var p=function(){function n(n,t,e,l,i,a,o){this.navCtrl=n,this.alertCtrl=t,this.loadingCtrl=e,this.platform=l,this.foodService=i,this.databaseService=a,this.temporalService=o,this.stream=null,this.cameraMode=r.Environment,this.loading=null,this.restaurant=this.temporalService.get()}return n.prototype.ngOnInit=function(){return c(this,void 0,void 0,function(){var n;return h(this,function(t){switch(t.label){case 0:return n=this,[4,this.loadingCtrl.create()];case 1:return n.loading=t.sent(),[4,this.loading.present()];case 2:return t.sent(),this.getStream(),[2]}})})},Object.defineProperty(n.prototype,"isMobile",{get:function(){return this.platform.is("ios")||this.platform.is("android")},enumerable:!0,configurable:!0}),n.prototype.cameraToggle=function(){return c(this,void 0,void 0,function(){var n;return h(this,function(t){switch(t.label){case 0:return n=this,[4,this.loadingCtrl.create()];case 1:return n.loading=t.sent(),[4,this.loading.present()];case 2:switch(t.sent(),this.cameraMode){case r.Environment:this.cameraMode=r.User;break;case r.User:default:this.cameraMode=r.Environment}return this.resetStream(),this.getStream(),[2]}})})},n.prototype.getStream=function(){return c(this,void 0,void 0,function(){var n,t,e,r,l=this;return h(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,5,6]),n=this,[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!1===l.isMobile||{facingMode:{exact:l.cameraMode}}})];case 1:return n.stream=i.sent(),t=this.stream.getVideoTracks()[0].getSettings().width,e=this.stream.getVideoTracks()[0].getSettings().height,this.camera.nativeElement.style.width=t+"px",this.camera.nativeElement.style.height=e+"px",this.camera.nativeElement.style.margin="-"+e/2+"px 0 0 -"+t/2+"px",this.video.nativeElement.srcObject=this.stream,[3,6];case 2:return r=i.sent(),[4,this.alertCtrl.create({header:"Failed",subHeader:r.message,buttons:["OK"]})];case 3:return[4,i.sent().present()];case 4:return i.sent(),[3,6];case 5:return this.loading&&(this.loading.dismiss(),this.loading=null),[7];case 6:return[2]}})})},n.prototype.resetStream=function(){this.video.nativeElement.srcObject=null,this.stream=null},n.prototype.capture=function(){return c(this,void 0,void 0,function(){var n,t,e,r;return h(this,function(l){switch(l.label){case 0:return n=this,[4,this.loadingCtrl.create()];case 1:return n.loading=l.sent(),[4,this.loading.present()];case 2:return l.sent(),t=this.stream.getVideoTracks()[0].getSettings().width,e=this.stream.getVideoTracks()[0].getSettings().height,(r=document.createElement("canvas")).width=t,r.height=e,r.getContext("2d").drawImage(this.video.nativeElement,0,0,t,e),this.post(r.toDataURL("image/png")),[2]}})})},n.prototype.post=function(n){return c(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,6,8]),[4,this.foodService.post(this.restaurant.id,n)];case 1:return t=e.sent(),[4,this.databaseService.eatFood(t.name,t.calorie)];case 2:return e.sent(),[4,this.alertCtrl.create({header:"\u4fdd\u5b58\u3057\u307e\u3057\u305f",buttons:["OK"]})];case 3:return[4,e.sent().present()];case 4:return e.sent(),this.navCtrl.navigateForward("/"),[3,8];case 5:throw e.sent();case 6:return[4,this.loading.dismiss()];case 7:return e.sent(),[7];case 8:return[2]}})})},n}(),b=function(){},f=e("pMnS"),d=e("ra/t"),m=e("ntG5"),g=e("CI40"),v=e("ZYCi"),y=e("fHOL"),w=e("tXrQ"),x=e("Ip0R"),k=e("CssM"),C=e("Eq7r"),S=e("YxxD"),M=l.qb({encapsulation:0,styles:[[".menuToggle[_ngcontent-%COMP%]{margin:16px;position:fixed;top:0;left:0;z-index:3}.reverse[_ngcontent-%COMP%]{font-size:24px;margin:16px;position:fixed;top:0;right:0;z-index:3}.capture[_ngcontent-%COMP%]{width:50px;height:50px;background:#3c3c3c;text-align:center;line-height:55px;color:#fff;border-radius:100%;bottom:16px;position:fixed;z-index:3;left:50%;margin:0 0 0 -25px;font-size:24px}.camera[_ngcontent-%COMP%]{top:50%;left:50%;position:fixed;z-index:1}"]],data:{}});function A(n){return l.Hb(0,[(n()(),l.sb(0,0,null,null,2,"div",[["class","reverse"]],null,[[null,"click"]],function(n,t,e){var r=!0;return"click"===t&&(r=!1!==n.component.cameraToggle()&&r),r},null,null)),(n()(),l.sb(1,0,null,null,1,"ion-icon",[["name","reverse-camera"]],null,null,null,d.B,d.i)),l.rb(2,49152,null,0,m.A,[l.l],{name:[0,"name"]},null)],function(n,t){n(t,2,0,"reverse-camera")},null)}function E(n){return l.Hb(0,[l.Eb(402653184,1,{camera:0}),l.Eb(402653184,2,{video:0}),(n()(),l.sb(2,0,null,null,11,"ion-header",[],null,null,null,d.A,d.h)),l.rb(3,49152,null,0,m.y,[l.l],null,null),(n()(),l.sb(4,0,null,0,9,"ion-toolbar",[],null,null,null,d.L,d.r)),l.rb(5,49152,null,0,m.xb,[l.l],null,null),(n()(),l.sb(6,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,d.w,d.d)),l.rb(7,49152,null,0,m.g,[],null,null),(n()(),l.sb(8,0,null,0,2,"ion-back-button",[],null,[[null,"click"]],function(n,t,e){var r=!0;return"click"===t&&(r=!1!==l.Cb(n,10).onClick(e)&&r),r},d.u,d.b)),l.rb(9,49152,null,0,m.c,[l.l],null,null),l.rb(10,16384,null,0,g.a,[[2,v.l],[2,y.a],w.a,l.l],null,null),(n()(),l.sb(11,0,null,0,2,"ion-title",[],null,null,null,d.K,d.s)),l.rb(12,49152,null,0,m.yb,[l.l],null,null),(n()(),l.Gb(13,0,["",""])),(n()(),l.sb(14,0,null,null,8,"ion-content",[["no-padding",""]],null,null,null,d.z,d.g)),l.rb(15,49152,null,0,m.r,[l.l],null,null),(n()(),l.jb(16777216,null,0,1,null,A)),l.rb(17,16384,null,0,x.i,[l.R,l.O],{ngIf:[0,"ngIf"]},null),(n()(),l.sb(18,0,null,0,2,"div",[["class","capture"]],null,[[null,"click"]],function(n,t,e){var r=!0;return"click"===t&&(r=!1!==n.component.capture()&&r),r},null,null)),(n()(),l.sb(19,0,null,null,1,"ion-icon",[["name","camera"]],null,null,null,d.B,d.i)),l.rb(20,49152,null,0,m.A,[l.l],{name:[0,"name"]},null),(n()(),l.sb(21,0,[[1,0],["camera",1]],0,1,"div",[["class","camera"]],null,null,null,null,null)),(n()(),l.sb(22,0,[[2,0],["video",1]],null,0,"video",[["autoplay",""],["muted",""],["playsinline",""]],null,null,null,null,null))],function(n,t){n(t,17,0,t.component.isMobile),n(t,20,0,"camera")},function(n,t){n(t,13,0,t.component.restaurant.name)})}var O=l.ob("app-camera",p,function(n){return l.Hb(0,[(n()(),l.sb(0,0,null,null,1,"app-camera",[],null,null,null,E,M)),l.rb(1,114688,null,0,p,[w.a,k.a,C.a,S.a,o,u.a,s.a],null,null)],function(n,t){n(t,1,0)},null)},{},{},[]),I=e("gIcY"),z=e("95zI"),P=e("9opb"),T=e("apKv"),j=e("B4/3");e.d(t,"CameraPageModuleNgFactory",function(){return F});var F=l.pb(b,[],function(n){return l.zb([l.Ab(512,l.k,l.eb,[[8,[f.a,O]],[3,l.k],l.z]),l.Ab(4608,x.k,x.j,[l.w,[2,x.q]]),l.Ab(4608,I.c,I.c,[]),l.Ab(4608,z.a,z.a,[l.B,l.g]),l.Ab(4608,P.a,P.a,[z.a,l.k,l.s]),l.Ab(4608,T.a,T.a,[z.a,l.k,l.s]),l.Ab(1073742336,x.b,x.b,[]),l.Ab(1073742336,I.b,I.b,[]),l.Ab(1073742336,I.a,I.a,[]),l.Ab(1073742336,j.a,j.a,[]),l.Ab(1073742336,v.n,v.n,[[2,v.t],[2,v.l]]),l.Ab(1073742336,b,b,[]),l.Ab(1024,v.j,function(){return[[{path:"",component:p}]]},[])])})}}]);